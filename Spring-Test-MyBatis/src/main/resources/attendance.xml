<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace에 고유한 이름을 주기 위해 -->
<mapper namespace="com.ssafy.springtest.model.dao.AttendanceDao">
	<!-- 
	List<Attendance> selectAttendance(User user) throws SQLException;
	void deleteAttendance(String ano) throws SQLException;
	void insertAttendance(Attendance attendance) throws SQLException;
	Attendance selectAttendanceByPK(String ano) throws SQLException;
	 -->
	<select id="selectAttendance" parameterType="user" resultType="attendance"> <!-- 별칭으로 간단하게 type을 줌! -->
		select ano, userid, issuedate, issue
		from attendance
		<if test="position == '교육생'">
			where userid = #{userid}
		</if>
	</select>
	
	<resultMap type="attendance" id="attendanceDetailMap">
		<result column="ano" property="ano" />
		<result column="userid" property="userid" />
		<result column="issuedate" property="issuedate" />
		<result column="issue" property="issue" />
		<association property="user" column="userid" select="selectUserByPK" />
	</resultMap>
	
	<select id="selectAttendanceByPK" parameterType="string" resultMap="attendanceDetailMap">
		
		select ano, userid, issuedate, issue
		from attendance 
		where ano = #{ano}
	</select>
	
	<select id="selectUserByPK" parameterType="string" resultType="user">
		select name, userid, rname, rclass, possition
		from userinfo
		where userid = #{userid}
	</select>
	
	<insert id="insertAttendance" parameterType="attendance">
		insert into attendance(
			ano, issuedate, issue, userid
		) values(
			<!-- #{attendance.getAno()} 원 이름은 이거 -->
			#{ano}, #{issuedate}, #{issue}, #{userid}
		)
	</insert>
	
	<delete id="deleteAttendance" parameterType="string">
		delete 
		from attendance 
		<!-- where ano = #{ano}  -->
		where ano in (
		
		<!-- 
		아래 foreach의 item은
		<c:forEach var="" items="" 와 같은 느낌
		 -->
		<foreach item="ano" collection="anos" open="(" close=")"  separator=",">
			{ano}
		</foreach>
		)
	</delete>
	
</mapper>